<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Event Check-in</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <div class="admin-header">
    <h1>ğŸ“ Admin Dashboard</h1>
    <div class="header-actions">
      <span id="userEmail"></span>
      <button onclick="handleLogout()" class="btn-secondary">ÄÄƒng xuáº¥t</button>
    </div>
  </div>

  <div class="container">
    <!-- Upload Section -->
    <div class="upload-section card">
      <h2>ğŸ“¤ Upload danh sÃ¡ch há»c sinh</h2>
      <p>File Excel cáº§n cÃ³ cÃ¡c cá»™t: Há» tÃªn, Lá»›p, Äi cÃ¹ng bá»‘ máº¹, Sá»‘ coupon, ÄÃ£ Ä‘Ã³ng phÃ­, Sá»‘ tiá»n phÃ­</p>
      
      <div class="upload-actions">
  <button onclick="downloadExcelTemplate()" class="btn-success">ğŸ“¥ Táº£i file Excel máº«u</button>
  <button onclick="showAddStudentForm()" class="btn-secondary">â• ThÃªm há»c sinh láº»</button>
</div>
      
      <input type="file" id="excelFile" accept=".xlsx,.xls" class="file-input">
      <button onclick="handleUpload()" class="btn-primary">Upload & Táº¡o QR Code</button>
      <div id="uploadStatus"></div>
    </div>

    <!-- Statistics Dashboard -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number" id="statTotal">0</div>
        <div class="stat-label">Tá»•ng há»c sinh</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="statCheckedIn">0</div>
        <div class="stat-label">ÄÃ£ check-in</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="statCheckedOut">0</div>
        <div class="stat-label">ÄÃ£ check-out</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="statNotArrived">0</div>
        <div class="stat-label">ChÆ°a Ä‘áº¿n</div>
      </div>
      <div class="stat-card stat-money">
        <div class="stat-number" id="statFeePaid">0</div>
        <div class="stat-label">ğŸ’° ÄÃ£ thu phÃ­</div>
      </div>
      <div class="stat-card stat-warning">
        <div class="stat-number" id="statFeeUnpaid">0</div>
        <div class="stat-label">â³ ChÆ°a thu phÃ­</div>
      </div>
      <div class="stat-card stat-success">
        <div class="stat-number" id="statTotalMoney">0Ä‘</div>
        <div class="stat-label">ğŸ’µ Tá»•ng tiá»n thu</div>
      </div>
    </div>

    <!-- Search and Filter -->
    <div class="search-filter-section card">
      <input type="text" id="searchInput" placeholder="ğŸ” TÃ¬m kiáº¿m tÃªn há»c sinh..." class="search-input">
      
      <div class="filter-buttons">
        <button class="filter-btn active" data-filter="all">Táº¥t cáº£</button>
        <button class="filter-btn" data-filter="not-arrived">ChÆ°a Ä‘áº¿n</button>
        <button class="filter-btn" data-filter="checked-in">ÄÃ£ check-in</button>
        <button class="filter-btn" data-filter="checked-out">ÄÃ£ check-out</button>
        <button class="filter-btn" data-filter="fee-paid">ÄÃ£ Ä‘Ã³ng phÃ­</button>
        <button class="filter-btn" data-filter="fee-unpaid">ChÆ°a Ä‘Ã³ng phÃ­</button>
        <button class="filter-btn" data-filter="with-parents">Äi cÃ¹ng bá»‘ máº¹</button>
        <button class="filter-btn" data-filter="alone">Äi má»™t mÃ¬nh</button>
      </div>

      <button onclick="exportToExcel()" class="btn-success">ğŸ“Š Export Excel</button>
    </div>

    <!-- Students List -->
    <div class="students-list" id="studentsList">
      <div class="loading">Äang táº£i dá»¯ liá»‡u...</div>
    </div>
  </div>

  <!-- Student Detail Modal -->
  <div id="studentModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <div id="modalContent"></div>
    </div>
  </div>

  <!-- QR Code Modal -->
  <div id="qrModal" class="modal">
    <div class="modal-content qr-modal-content">
      <span class="close" onclick="closeQRModal()">&times;</span>
      <div id="qrContent"></div>
    </div>
  </div>

  <!-- Add Student Modal -->
  <div id="addStudentModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeAddStudentModal()">&times;</span>
      <h2>â• ThÃªm há»c sinh má»›i</h2>
      
      <form id="addStudentForm" onsubmit="handleAddStudentOrUpdate(event)">
        <div class="form-group">
          <label>Há» tÃªn *</label>
          <input type="text" id="newStudentName" required class="form-input">
        </div>
        
        <div class="form-group">
          <label>Lá»›p *</label>
          <input type="text" id="newStudentClass" required class="form-input" placeholder="VD: 1A, 2B...">
        </div>
        
        <div class="form-group">
          <label>Äi cÃ¹ng bá»‘ máº¹</label>
          <select id="newStudentAccompanied" class="form-input">
            <option value="KhÃ´ng">KhÃ´ng (Ä‘i má»™t mÃ¬nh)</option>
            <option value="CÃ³ (1 ngÆ°á»i)">CÃ³ (1 ngÆ°á»i)</option>
            <option value="CÃ³ (2 ngÆ°á»i)" selected>CÃ³ (2 ngÆ°á»i)</option>
            <option value="CÃ³ (3 ngÆ°á»i)">CÃ³ (3 ngÆ°á»i)</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Sá»‘ coupon</label>
          <input type="number" id="newStudentCoupons" value="0" min="0" class="form-input">
        </div>
        
        <div class="form-group">
          <label>Sá»‘ tiá»n phÃ­ (VNÄ)</label>
          <input type="number" id="newStudentFee" value="200000" min="0" step="1000" class="form-input">
        </div>
        
        <div class="form-group">
          <label>Tráº¡ng thÃ¡i phÃ­</label>
          <div class="radio-group">
            <label>
              <input type="radio" name="newFeeStatus" value="unpaid" checked>
              ChÆ°a Ä‘Ã³ng
            </label>
            <label>
              <input type="radio" name="newFeeStatus" value="paid">
              ÄÃ£ Ä‘Ã³ng
            </label>
          </div>
        </div>
        
        <div class="form-group">
          <label>Ghi chÃº (tÃ¹y chá»n)</label>
          <textarea id="newStudentNote" class="form-input" rows="2"></textarea>
        </div>
        
        <button type="submit" class="btn-primary">ğŸ’¾ LÆ°u há»c sinh</button>
      </form>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <!-- KhÃ´ng cáº§n Storage -->
  <script src="../js/firebase-config.js"></script>
  
  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  
  <script src="../js/admin.js"></script>
</body>
</html>
